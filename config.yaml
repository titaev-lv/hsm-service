server:
  port: "8443"
  tls:
    ca_path: /app/pki/ca/ca.crt
    cert_path: /app/pki/server/hsm-service.local.crt
    key_path: /app/pki/server/hsm-service.local.key
  # HTTP/2 configuration for maximum throughput on dedicated HSM machines
  # Rationale: Default HTTP/2 settings bottleneck at ~250 concurrent streams
  # Analysis showed CPU idle at 10% while rejecting 95% of spike requests
  # These aggressive settings maximize resource utilization for high-load scenarios
  http2:
    max_concurrent_streams: "2000"       # Default: ~250, Target: handle 2000+ req/s
    initial_window_size: "4M"            # Default: 64KB, Increase for throughput
    max_frame_size: "1M"                 # Default: 16KB, Larger frames = fewer syscalls
    max_header_list_size: "2M"           # Default: varies, Support large mTLS headers
    idle_timeout_seconds: 120            # Connection reuse for sustained load
    max_upload_buffer_per_conn: "4M"     # Memory budget per connection
    max_upload_buffer_per_stream: "4M"   # Memory budget per stream

hsm:
  pkcs11_lib: /usr/lib/softhsm/libsofthsm2.so
  slot_id: hsm-token
  metadata_file: /app/metadata.yaml  # Dynamic rotation metadata
  max_versions: 3  # Maximum key versions to keep
  cleanup_after_days: 30  # Auto-delete versions older than N days
  keys:
    exchange-key:
      type: aes
    2fa:
      type: aes

acl:
  revoked_file: /app/pki/revoked.yaml
  mappings:
    Trading:
      - exchange-key
    2FA:
      - 2fa
    Database: []

rate_limit:
  requests_per_second: 50000
  burst: 5000

logging:
  level: info
  format: json
